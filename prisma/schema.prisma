generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RawMessage {
  id         BigInt   @id @default(autoincrement())
  topic      String
  payload    String
  receivedAt DateTime @default(now())
  parseOk    Boolean  @default(false)
  error      String?

  @@index([receivedAt])
}

model DroneDetection {
  id         BigInt   @id @default(autoincrement())
  receivedAt DateTime @default(now())
  deviceTs   DateTime
  droneId    String
  latDeg     Float
  lonDeg     Float
  altM       Float
  speedMps   Float
  radiusM    Float?
  angleDeg   Float?
  rawId      BigInt?
  bboxH      Int?
  bboxW      Int?
  bboxX      Int?
  bboxY      Int?
  confidence Float?
  frameId    BigInt?
  sourceId   String?
  type       String?
  frame      Frame?   @relation(fields: [frameId], references: [id])

  @@index([deviceTs])
  @@index([droneId, deviceTs(sort: Desc)])
  @@index([frameId])
}

model Frame {
  id           BigInt           @id @default(autoincrement())
  receivedAt   DateTime         @default(now())
  frameNo      Int
  deviceTs     DateTime
  sourceId     String
  imageBase64  String?
  objectsCount Int
  detections   DroneDetection[]

  @@index([deviceTs])
  @@index([sourceId, deviceTs])
}

model Mark {
  id        String   @id
  name      String
  color     String
  latDeg    Float
  lonDeg    Float
  radiusM   Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([createdAt])
  @@index([latDeg, lonDeg])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}
