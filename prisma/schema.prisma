generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RawMessage {
  id         BigInt   @id @default(autoincrement())
  topic      String
  payload    String
  receivedAt DateTime @default(now())
  parseOk    Boolean  @default(false)
  error      String?

  @@index([receivedAt])
}

model Frame {
  id              BigInt   @id @default(autoincrement())
  framId          String   // frame id
  camId           String   // camera id
  cameraName      String   // from token_id.camera_info.name
  cameraSort      String   // from token_id.camera_info.sort
  cameraLocation  String   // from token_id.camera_info.location
  cameraInstitute String   // from token_id.camera_info.institute
  timestamp       DateTime // timestamp from frame
  imageWidth      Int      // from image_info.width
  imageHeight     Int      // from image_info.height
  receivedAt      DateTime @default(now())
  objects         FrameObject[]

  @@index([timestamp])
  @@index([camId, timestamp])
}

model FrameObject {
  id        BigInt   @id @default(autoincrement())
  objId     String   // object id
  type      String?  // object type (optional)
  lat       Float    // latitude
  lng       Float    // longitude
  alt       Float    // altitude
  speedKt   Float    // speed in knots
  frameId   BigInt
  frame     Frame    @relation(fields: [frameId], references: [id], onDelete: Cascade)

  @@index([objId])
  @@index([frameId])
}

model Mark {
  id        String   @id
  name      String
  color     String
  latDeg    Float
  lonDeg    Float
  radiusM   Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([createdAt])
  @@index([latDeg, lonDeg])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}
